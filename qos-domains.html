<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-qos-domains" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">QoS Domains | API Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="robots" content="noindex, nofollow"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://SoftwareEnabledFlash.github.io/SEF-API/qos-domains"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="QoS Domains | API Docs"><meta data-rh="true" name="description" content="chap-QoSDomain}"><meta data-rh="true" property="og:description" content="chap-QoSDomain}"><link data-rh="true" rel="icon" href="/SEF-API/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://SoftwareEnabledFlash.github.io/SEF-API/qos-domains"><link data-rh="true" rel="alternate" href="https://SoftwareEnabledFlash.github.io/SEF-API/qos-domains" hreflang="en"><link data-rh="true" rel="alternate" href="https://SoftwareEnabledFlash.github.io/SEF-API/qos-domains" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://4NVQ99YLZU-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="API Docs" href="/SEF-API/opensearch.xml"><link rel="stylesheet" href="/SEF-API/assets/css/styles.a03c588d.css">
<link rel="preload" href="/SEF-API/assets/js/runtime~main.91958225.js" as="script">
<link rel="preload" href="/SEF-API/assets/js/main.0c34905c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/SEF-API/"><div class="navbar__logo"><img src="/SEF-API/img/sef-light-logo.png" alt="SEF Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/SEF-API/img/sef-light-dark.png" alt="SEF Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">API Docs</b></a><a href="https://softwareenabledflash.github.io/SEF-SDK/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">SDK Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/SEF-API/">1.14</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/SEF-API/qos-domains">1.14</a></li><li><a class="dropdown__link" href="/SEF-API/1.13/qos-domains">1.13</a></li><li><a class="dropdown__link" href="/SEF-API/1.10/qos-domains">1.10</a></li></ul></div><a href="https://github.com/SoftwareEnabledFlash/SEF-API/blob/v1.14i/SEF-API-01-14.pdf" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Download PDF<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/SoftwareEnabledFlash/SEF-API" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SEF-API/">Legal Disclaimer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SEF-API/license">Licenses</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SEF-API/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SEF-API/definitions">Definitions and Acronyms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SEF-API/sef-unit">SEF Unit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SEF-API/virtual-devices">Virtual Devices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/SEF-API/qos-domains">QoS Domains</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SEF-API/super-pages">Super Pages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SEF-API/super-blocks">Super Blocks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SEF-API/delayed-writes">Delayed Writes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SEF-API/addressing">Addressing</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/SEF-API/SEF_API/sef-api00">SEF_API</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/SEF-API/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">QoS Domains</span><meta itemprop="position" content="1"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 1.14</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>QoS Domains</h1><p>A QoS domain is the mechanism used to access data within a SEF Unit. QoS domains are created
within a virtual device, and it is possible to have multiple QoS domains sharing a single virtual
device. When multiple QoS domains share a virtual device, they will draw from a common pool of
super blocks. However a super block is never shared between QoS domains and so data for QoS
domains will never be intermingled in a super block. When QoS domains share a virtual device,
there is no hardware isolation between them, so die-time conflicts are possible. The scheduling and
prioritization features of SEF are used to order I/O for shared virtual devices and to resolve these
die-time conflicts (e.g., software-defined isolation/quality of service).</p><p>When a QoS domain is created, several parameters are specified to define the characteristics
of the QoS domain, which will be discussed below. Upon successful creation of a QoS domain,
a device node will be created in the operating system namespace corresponding to the newly
created QoS domain. It has a capacity and quota. The capacity is storage reserved in the virtual
device for use by the QoS domain. The quota is how much total storage can be assigned to
the QoS domain. Initially the quota is set to the capacity, but both can be changed later using
<a href="/SEF-API/SEF_API/sef-api00#function-SEFSetQoSDomainCapacity">SEFSetQoSDomainCapacity</a>. At boot time the SEF Unit
driver will create device nodes for all QoS domains previously defined for the device. Device nodes for
QoS domains may be used to enumerate existing QoS domains as well as to restrict access to/enforce
ownership of a QoS domain. All user data access commands are issued against a QoS domain.
Typically, a QoS domain will be used by a single application or Flash Translation Layer/block
driver/key value driver.
An example of how the virtual devices of a SEF Unit could be divided into QoS domains is shown
in the following figure <a href="#fig-QoSDomainExample">5</a>. A QoS domain is a logical construct that
defines a capacity taken from its virtual device’s capacity. It also defines a quota that may exceed
the capacity of the virtual device as shown with QoS domains three through four. A SEF Unit can
have at most 65534 QoS domains defined. The actual limit depends on the specific hardware.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fig-QoSDomainExample">Figure 5: QoS Domain Example<a href="#fig-QoSDomainExample" class="hash-link" aria-label="Direct link to Figure 5: QoS Domain Example" title="Direct link to Figure 5: QoS Domain Example">​</a></h4><p><img loading="lazy" alt="QoS Domain Example" src="/SEF-API/assets/images/qos-domain-example-81360f797e8c079f8473026aa42eb26d.png" width="869" height="529" class="img_ev3q"></p><p>Allocated super blocks are owned by only one QoS domain at a time and are never shared. Super
blocks are allocated from a shared pool allowing for host-managed thin provisioning. A QoS domain
can allocate super blocks until it hits its quota or the free pool is exhausted.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creation-time-parameters">Creation-time Parameters<a href="#creation-time-parameters" class="hash-link" aria-label="Direct link to Creation-time Parameters" title="Direct link to Creation-time Parameters">​</a></h2><p><strong>vdHandle</strong>: the handle to the virtual device the QoS domain will be created in.</p><p><strong>QoSDomainID</strong>: an identifier that will later be used to specify the created QoS domain. This identifier
must be unique across the entire SEF Unit. Valid IDs start at 1 and must be less than or equal
to ‘maxQoSDomains‘ returned by <a href="/SEF-API/SEF_API/sef-api00#function-SEFGetInformation">SEFGetInformation</a>.</p><p><strong>flashCapacity</strong>: the number of 4KiB ADUs reserved for the QoS domain. It supplies a capacity
and a quota. The capacity is subtracted from the available ADUs from the virtual device so must
be less than the currently available ADUs.</p><p><strong>pSLCFlashCapacity</strong>: the number of 4KiB pSLC ADUs reserved for the QoS domain. It supplies
a capacity and a quota. The capacity is subtracted from the available pSLC ADUs from the virtual
device so must be less than the currently available pSLC ADUs.</p><p><strong>ADUIndex</strong>: this is the index into the ADUSize[] array in ‘SEFInfo‘ returned by
<a href="/SEF-API/SEF_API/sef-api00#function-SEFGetInformation">SEFGetInformation</a> to select the data and metadata sizes of an
ADU.</p><p><strong>api</strong>: this field specifies the API to be used for this QoS domain. Currently only the super block
API is supported.</p><p><strong>defectStrategy</strong>: Specifies how defective ADUs are handled by the QoS domain. The choices are
Perfect, Packed or Fragmented. The Perfect strategy hides defective ADUs through overprovisioning
and mapping. Capacity is reserved, and ADUs are remapped to provide static and consistent flash
memory addresses with contiguous ADU offsets. Packed also hides defective ADUs presenting
consistent flash memory addresses with contiguous ADU offsets, but the size of super blocks will
shrink as the device wears. With the Fragmented strategy, the client is exposed to the device’s
defect management. ADU offsets are non-contiguous, and super blocks will shrink in size as the
device wears. Refer to <a href="/SEF-API/addressing#chap-Addressing">Addressing</a> Chapter for more details.</p><p><strong>recovery</strong>: Specifies the error recovery strategy for this QoS domain.</p><p><strong>encryption</strong>: specifies the key the QoS domain is to be encrypted with.</p><p><strong>numPlacementIDs</strong>: specifies the number of separate, simultaneously opened super blocks that
may be used by the QoS domain in auto allocation mode. It does not affect the number of manually
opened super blocks, which instead depends on the device itself.</p><p><strong>maxOpenSuperBlocks</strong>: this is the maximum number super blocks that can be open in a QoS
domain. If less than numPlacementIDs it will be set to numPlacementIDs+2. This affects resource
and memory usage in the device.</p><p><strong>defaultReadQueue</strong>: specifies the default read queue to use for read I/O operations. This can
be optionally overridden when submitting I/O to a QoS domain. Read queues are defined by the
virtual device and shared by the QoS domains defined in the same virtual device.</p><p><strong>weights</strong>: Specifies the default weights for erase and program.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/SEF-API/virtual-devices"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Virtual Devices</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/SEF-API/super-pages"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Super Pages</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#creation-time-parameters" class="table-of-contents__link toc-highlight">Creation-time Parameters</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Software-Enabled Flash Project. Built with Docusaurus.</div></div></div></footer></div>
<script src="/SEF-API/assets/js/runtime~main.91958225.js"></script>
<script src="/SEF-API/assets/js/main.0c34905c.js"></script>
</body>
</html>